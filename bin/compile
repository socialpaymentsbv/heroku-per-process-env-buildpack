#!/usr/bin/env bash

set -euo pipefail

BUILD_DIR="$1"
CACHE_DIR="$2"
ENV_DIR="$3"

BP_DIR="$(cd "$(dirname "$0")/.." && pwd)"
PROFILE_DIR="$BUILD_DIR/.profile.d"
RUNTIME_SCRIPT="00-per-process-env.sh"

echo "BUILD_DIR=$BUILD_DIR"
echo "CACHE_DIR=$CACHE_DIR"
echo "ENV_DIR=$ENV_DIR"
echo "BP_DIR=$BP_DIR"
echo "PROFILE_DIR=$PROFILE_DIR"
echo "RUNTIME_SCRIPT=$BP_DIR/lib/$RUNTIME_SCRIPT"
ls -al "$BP_DIR/lib/per-process-env.sh"

mkdir -p "$PROFILE_DIR"
cp "$BP_DIR/lib/per-process-env.sh" "$PROFILE_DIR/$RUNTIME_SCRIPT"
chmod +x "$PROFILE_DIR/$RUNTIME_SCRIPT"

echo "-----> Installed per-process env script to .profile.d"
